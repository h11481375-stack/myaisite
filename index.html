<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoe DIY Studio | æœ¬åœ°ä¸“å®¶ç‰ˆ</title>
    <style>
        :root { --pink: #ffafbd; --deep-pink: #ff8e9a; --bg: #ffffff; }
        body, html { height: 100%; margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: #4a4a4a; overflow: hidden; }
        #main-container { display: flex; flex-direction: column; height: 100vh; max-width: 800px; margin: 0 auto; }
        header { padding: 15px; text-align: center; border-bottom: 1px solid #fdf2f4; cursor: pointer; background: #fff; }
        header h1 { margin: 0; font-size: 1.2rem; color: var(--deep-pink); letter-spacing: 2px; }
        #status-bar { font-size: 10px; color: #bbb; margin-top: 5px; }

        /* é…ç½®å¼¹çª— */
        #config-panel { display: none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; background: #fff; box-shadow: 0 5px 30px rgba(0,0,0,0.2); border-radius: 15px; padding: 20px; z-index: 100; border: 2px solid var(--pink); }
        textarea { width: 100%; height: 200px; border: 1px solid #eee; border-radius: 10px; padding: 10px; box-sizing: border-box; font-size: 12px; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #eee; border-radius: 20px; box-sizing: border-box; }

        #chat-box { flex: 1; overflow-y: auto; padding: 20px; background: #fff; }
        .row { display: flex; margin-bottom: 15px; }
        .user-row { justify-content: flex-end; }
        .bubble { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.5; }
        .user-bubble { background: #ffe4e8; color: #d63384; }
        .ai-bubble { background: #f4f4f4; color: #444; border: 1px solid #eee; }

        .input-area { padding: 15px; border-top: 1px solid #f8f8f8; display: flex; gap: 10px; background: #fff; }
        #userInput { flex: 1; border: 2px solid #ffe4e8; border-radius: 25px; padding: 10px 20px; outline: none; }
        .send-btn { background: var(--pink); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>

<div id="main-container">
    <header onclick="toggleConfig()">
        <h1>ZOE DIY STUDIO ğŸŒ¸</h1>
        <div id="status-bar">ç‚¹å‡»é…ç½® AI Key ä¸åŒæ­¥ 1400 è¡Œæ•°æ®</div>
    </header>

    <div id="chat-box">
        <div class="row"><div class="bubble ai-bubble">ä½ å¥½ï¼è¯·ç‚¹å‡»ä¸Šæ–¹æ ‡é¢˜ï¼Œè´´å…¥ä½ çš„æ™ºè°± Key å’Œ 1400 è¡Œåº“å­˜æ•°æ®ã€‚è´´å®Œä¸€æ¬¡ï¼Œæˆ‘å°±èƒ½æ°¸è¿œè®°ä½å®ƒä»¬å–”ï¼âœ¨</div></div>
    </div>

    <div id="config-panel">
        <h3 style="color:var(--deep-pink); margin-top:0;">ç³»ç»Ÿåˆå§‹åŒ–</h3>
        <input type="password" id="apiKey" placeholder="åœ¨æ­¤ç²˜è´´æ™ºè°± API Key">
        <p style="font-size: 12px; color: #888;">è¯·ç›´æ¥ä»é£ä¹¦/Excel å¤åˆ¶å…¨éƒ¨å†…å®¹ï¼ˆSKUã€åç§°ã€ä»“ä½ã€åº“å­˜ï¼‰ï¼š</p>
        <textarea id="dataInput" placeholder="ç›´æ¥å…¨é€‰ç²˜è´´ 1400 è¡Œæ•°æ®..."></textarea>
        <button onclick="saveConfig()" style="width:100%; background:var(--deep-pink); color:white; border:none; padding:12px; border-radius:25px; margin-top:10px; cursor:pointer;">ä¿å­˜åœ¨è„‘å­é‡Œ</button>
        <button onclick="toggleConfig()" style="width:100%; background:none; border:none; color:#ccc; margin-top:5px; cursor:pointer;">å–æ¶ˆ</button>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="è¾“å…¥ SKU æˆ–å…³é”®è¯..." onkeypress="if(event.keyCode==13) handleSend()">
        <button class="send-btn" onclick="handleSend()">ğŸ’–</button>
    </div>
</div>

<script>
    // è‡ªåŠ¨åŠ è½½ä¸Šæ¬¡ä¿å­˜çš„æ•°æ®
    window.onload = () => {
        const savedData = localStorage.getItem('zoe_database');
        if(savedData) {
            const count = savedData.split('\n').length;
            document.getElementById('status-bar').innerText = `âœ… å·²åŠ è½½ ${count} è¡Œæœ¬åœ°æ•°æ®ï¼Œéšæ—¶å¯æŸ¥`;
        }
    };

    function toggleConfig() {
        const p = document.getElementById('config-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        document.getElementById('apiKey').value = localStorage.getItem('zhipu_key') || '';
    }

    function saveConfig() {
        const key = document.getElementById('apiKey').value;
        const data = document.getElementById('dataInput').value;
        if(key) localStorage.setItem('zhipu_key', key);
        if(data) localStorage.setItem('zoe_database', data);
        
        alert("Zoe è®°ä½äº†ï¼ç°åœ¨ä½ å¯ä»¥æŸ¥åº“å­˜äº†ã€‚ğŸŒ¸");
        location.reload(); // åˆ·æ–°è®©æ•°æ®ç”Ÿæ•ˆ
    }

    async function handleSend() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        const apiKey = localStorage.getItem('zhipu_key');
        const database = localStorage.getItem('zoe_database') || "æš‚æ— åº“å­˜æ•°æ®";
        
        if(!apiKey) { alert("è¯·å…ˆå¡«å…¥ API Keyï¼"); toggleConfig(); return; }
        if(!text) return;

        addMsg(text, 'user');
        input.value = '';
        const aiBubble = addMsg("Zoe æ­£åœ¨æ ¸å¯¹è´¦æœ¬...", 'ai');

        try {
            const response = await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                body: JSON.stringify({
                    model: "glm-4",
                    messages: [
                        { role: "system", content: `ä½ æ˜¯DIYåŠ©ç†Zoeã€‚è¿™æ˜¯ä½ çš„å…¨é‡åº“å­˜åº“ï¼š\n${database}\nè¯·æ ¹æ®æ­¤æ•°æ®æŸ¥SKUã€ä»“ä½å’Œåº“å­˜ã€‚è¦æ±‚ï¼š1. è¯­è°ƒç”œç¾ã€‚2. å¿…é¡»ç»™å‡ºæ˜ç¡®çš„ä»“ä½ç¼–å·ã€‚3. å›ç­”å®Œåæé†’ç”¨æˆ·å¦‚æœéœ€è¦æ›´æ–°ï¼Œè¯·ç‚¹å‡»æ ‡é¢˜é‡æ–°ç²˜è´´ã€‚` },
                        { role: "user", content: text }
                    ]
                })
            });
            const data = await response.json();
            const reply = data.choices[0].message.content;
            aiBubble.innerText = reply;
            
            // è¯­éŸ³æ’­æŠ¥
            const msg = new SpeechSynthesisUtterance(reply);
            msg.pitch = 1.35;
            window.speechSynthesis.speak(msg);
        } catch (e) { aiBubble.innerText = "å‡ºé”™äº†ï¼Œå¯èƒ½æ˜¯ API Key ä¸å¯¹å–”ã€‚"; }
    }

    function addMsg(text, role) {
        const row = document.createElement('div');
        row.className = `row ${role}-row`;
        row.innerHTML = `<div class="bubble ${role}-bubble">${text}</div>`;
        const box = document.getElementById('chat-box');
        box.appendChild(row);
        box.scrollTop = box.scrollHeight;
        return row.lastChild;
    }
</script>
</body>
</html>
