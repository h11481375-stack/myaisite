<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoe DIY Studio | çµæ„ŸåŠ©æ‰‹</title>
    <style>
        :root { 
            --primary-pink: #ffafbd; 
            --accent-pink: #ff8e9a;
            --bg-white: #ffffff; 
            --user-bubble: #ffe4e8; 
            --ai-text: #4a4a4a;
        }
        
        body, html { height: 100%; margin: 0; font-family: -apple-system, "PingFang SC", sans-serif; background: var(--bg-white); color: var(--ai-text); }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        header { 
            padding: 15px; 
            text-align: center; 
            background: #fff; 
            border-bottom: 1px solid #f0f0f0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        header h1 { margin: 0; font-size: 1.2rem; color: var(--accent-pink); letter-spacing: 1px; }

        /* èŠå¤©ä¸»å®¹å™¨ */
        #chat-container { display: flex; flex-direction: column; height: calc(100vh - 60px); max-width: 700px; margin: 0 auto; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth; }
        
        /* æ¶ˆæ¯è¡Œ */
        .message-row { display: flex; width: 100%; margin-bottom: 20px; animation: fadeIn 0.3s ease; }
        .user-row { justify-content: flex-end; }
        .ai-row { justify-content: flex-start; align-items: flex-start; }

        /* æ°”æ³¡æ ·å¼ */
        .bubble { max-width: 75%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.5; position: relative; }
        .user-bubble { background: var(--user-bubble); color: #d63384; border-bottom-right-radius: 4px; }
        .ai-bubble { background: #f8f9fa; color: var(--ai-text); border-bottom-left-radius: 4px; border: 1px solid #eee; }
        
        /* å¤´åƒ */
        .avatar { width: 32px; height: 32px; border-radius: 50%; margin-right: 10px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .ai-avatar { background: var(--primary-pink); color: white; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* è¾“å…¥åŒº */
        .input-area { padding: 20px; background: #fff; }
        .input-wrapper { display: flex; align-items: center; background: #fdfdfd; border: 1.5px solid #ffe4e8; border-radius: 25px; padding: 8px 15px; }
        input { flex: 1; background: none; border: none; font-size: 15px; outline: none; padding: 5px; color: #666; }
        
        .icon-btn { background: none; border: none; cursor: pointer; color: var(--primary-pink); font-size: 20px; padding: 5px 10px; transition: 0.2s; }
        .icon-btn:hover { transform: scale(1.1); color: var(--accent-pink); }
        .active-mic { color: #ff4b2b; animation: pulse 1s infinite; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        
        #config-trigger { position: fixed; top: 15px; right: 15px; font-size: 12px; color: #ccc; cursor: pointer; }
    </style>
</head>
<body>

<div id="config-trigger" onclick="setKey()">Key è®¾ç½®</div>

<header>
    <h1>ZOE DIY STUDIO</h1>
</header>

<div id="chat-container">
    <div id="chat-box">
        <div class="message-row ai-row">
            <div class="avatar ai-avatar">Z</div>
            <div class="bubble ai-bubble">ä½ å¥½å‘€ï¼æˆ‘æ˜¯ Zoe ğŸŒ¸<br>æˆ‘å·²ç»æŠŠåº“å­˜é‡Œçš„è´è¶ã€éƒé‡‘é¦™ã€æ‹¼è±†è´´çº¸éƒ½è®°åœ¨è„‘å­é‡Œå•¦ã€‚ä½ å¯ä»¥ç‚¹å‡»éº¦å…‹é£è·Ÿæˆ‘èŠå¤©ï¼Œæˆ–è€…è¾“å…¥ SKU é—®æˆ‘å“¦ã€‚</div>
        </div>
    </div>

    <div class="input-area">
        <div class="input-wrapper">
            <button class="icon-btn" id="micBtn" onclick="toggleVoice()">ğŸ¤</button>
            <input type="text" id="userInput" placeholder="é—®é—®å…³äº FS ç³»åˆ—äº§å“..." autocomplete="off">
            <button class="icon-btn" onclick="handleSend()">ğŸ’–</button>
        </div>
    </div>
</div>

<script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('userInput');
    const micBtn = document.getElementById('micBtn');

    // äº§å“æ•°æ®ç´¢å¼• (ç”± Product.xlsx æå–)
    const PRODUCT_CONTEXT = "SKU List: FS6807(Ribbon Mirror Patch), FS0317(Butterfly with Diamonds), FS5378(Metal Lotus), FS5290(Metal Patch), FS10221(Zootopia Stickers), FS10184(Tulip Fabric Flower), FS10196(Sanrio Stickers). Provide inventory and DIY tips.";

    // è¯­éŸ³è¯†åˆ« (STT)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'zh-CN';
        recognition.onresult = (e) => {
            userInput.value = e.results[0][0].transcript;
            toggleVoice();
            handleSend();
        };
    }

    function toggleVoice() {
        if (!recognition) { alert("æµè§ˆå™¨ä¸æ”¯æŒå½•éŸ³å“¦"); return; }
        micBtn.classList.toggle('active-mic');
        micBtn.classList.contains('active-mic') ? recognition.start() : recognition.stop();
    }

    // è¯­éŸ³åˆæˆ (TTS)
    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'zh-CN';
        msg.rate = 1.1; // ç¨å¾®å¿«ä¸€ç‚¹ç‚¹æ˜¾æ´»æ³¼
        window.speechSynthesis.speak(msg);
    }

    function setKey() {
        const key = prompt("è¯·è¾“å…¥ API Key:");
        if(key) localStorage.setItem('zhipu_key', key);
    }

    async function handleSend() {
        const text = userInput.value.trim();
        const apiKey = localStorage.getItem('zhipu_key');
        if (!text || !apiKey) { if(!apiKey) setKey(); return; }

        addMsg(text, 'user');
        userInput.value = '';
        const aiBubble = addMsg("Zoe æ­£åœ¨ç¿»æ‰¾ç¬”è®°...", 'ai');

        try {
            const response = await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions", {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                body: JSON.stringify({
                    model: "glm-4",
                    messages: [
                        { role: "system", content: "ä½ æ˜¯ä¸€ä½å¯çˆ±ä¸”ä¸“ä¸šçš„DIYä¸“å®¶Zoeã€‚ä½ äº†è§£è¿™äº›äº§å“ï¼š" + PRODUCT_CONTEXT + "ã€‚è¯·ç”¨ç”œç¾é¼“åŠ±çš„è¯­æ°”ç”¨ä¸­æ–‡å›ç­”ã€‚å°½é‡ç®€æ´ã€‚" },
                        { role: "user", content: text }
                    ]
                })
            });
            const data = await response.json();
            const reply = data.choices[0].message.content;
            aiBubble.innerText = reply;
            speak(reply);
        } catch (e) { aiBubble.innerText = "ä¿¡å·ä¸å¤ªå¥½ï¼Œè¯·ç¨åå†è¯•å“¦ã€‚"; }
    }

    function addMsg(text, role) {
        const isAi = role === 'ai';
        const row = document.createElement('div');
        row.className = `message-row ${isAi ? 'ai-row' : 'user-row'}`;
        row.innerHTML = isAi ? 
            `<div class="avatar ai-avatar">Z</div><div class="bubble ai-bubble">${text}</div>` :
            `<div class="bubble user-bubble">${text}</div>`;
        chatBox.appendChild(row);
        chatBox.scrollTop = chatBox.scrollHeight;
        return row.querySelector('.bubble');
    }

    userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });
</script>
</body>
</html>

